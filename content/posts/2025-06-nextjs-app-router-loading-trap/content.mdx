ä½ æ˜¯å¦æ›¾ç¶“é‡éé€™ç¨®æƒ…æ³ï¼šNext.js æ‡‰ç”¨çªç„¶ç„¡æ³•æ­£å¸¸è¼‰å…¥ï¼Œé é¢æ°¸é å¡åœ¨ Loading ç‹€æ…‹ï¼Ÿé€™å€‹çœ‹ä¼¼ç°¡å–®çš„å•é¡Œï¼Œå¯èƒ½æœƒè®“é–‹ç™¼è€…èŠ±è²»æ•¸å°æ™‚é™¤éŒ¯ã€‚

ä»Šå¤©è¦åˆ†äº«çš„æ˜¯ä¸€å€‹çœŸå¯¦æ¡ˆä¾‹ï¼š**ä¸€å€‹çœ‹ä¼¼ç„¡å®³çš„ `app/loading.tsx` æ–‡ä»¶ï¼Œå¦‚ä½•è®“æ•´å€‹æ‡‰ç”¨é™·å…¥ç„¡æ³•è¼‰å…¥çš„å›°å¢ƒ**ã€‚

## ğŸ”¥ å±æ©Ÿç¾è±¡ï¼šæ‡‰ç”¨å®Œå…¨ç„¡æ³•ä½¿ç”¨

ç•¶å•é¡Œç™¼ç”Ÿæ™‚ï¼Œæ•´å€‹æ‡‰ç”¨æœƒå‡ºç¾ä»¥ä¸‹ç—‡ç‹€ï¼š

### ä¸»è¦éŒ¯èª¤è¡¨ç¾

- âŒ é é¢é¡¯ç¤º `"missing required error components, refreshing..."`
- âŒ ç€è¦½å™¨æ§åˆ¶å°ä¸æ–·å‡ºç¾ 500 éŒ¯èª¤
- âŒ æ‰€æœ‰é é¢éƒ½ç„¡æ³•æ­£å¸¸è¼‰å…¥å…§å®¹
- âŒ å³ä½¿æœ€åŸºæœ¬çš„éœæ…‹é é¢ä¹Ÿç„¡æ³•é¡¯ç¤º

### ç”¨æˆ¶é«”é©—å½±éŸ¿

- ğŸš« å®Œå…¨ç„¡æ³•è¨ªå•ç¶²ç«™
- ğŸ”„ é é¢ä¸æ–·é‡æ–°æ•´ç†ä½†æ°¸é è¼‰å…¥ä¸å®Œ
- â° è¼‰å…¥æŒ‡ç¤ºå™¨æ°¸é è½‰åœˆåœˆ

## ğŸ•µï¸ å•é¡Œæ ¹æºè¿½æŸ¥

### ç½ªé­ç¦é¦–ï¼šçœ‹ä¼¼ç„¡å®³çš„ loading.tsx

ç¶“éé€æ­¥æ’é™¤ï¼Œç™¼ç¾å•é¡Œå‡ºç¾åœ¨é€™å€‹ `app/loading.tsx` æ–‡ä»¶ï¼š

```tsx
// âŒ å•é¡Œä»£ç¢¼ï¼šçœ‹èµ·ä¾†æ­£å¸¸ï¼Œå¯¦éš›ä¸Šæœ‰é™·é˜±
export default function Loading() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="text-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
        <p className="mt-4 text-gray-600">Loading...</p>
      </div>
    </div>
  );
}
```

**ç¬¬ä¸€å°è±¡**ï¼šç¨‹å¼ç¢¼çœ‹èµ·ä¾†å®Œå…¨æ­£å¸¸ï¼Œåªæ˜¯ä¸€å€‹ç°¡å–®çš„è¼‰å…¥å‹•ç•«çµ„ä»¶ã€‚

**å¯¦éš›çµæœ**ï¼šå»å°è‡´æ•´å€‹ Next.js æ‡‰ç”¨é™·å…¥ç„¡é™è¼‰å…¥å¾ªç’°ï¼

### ç‚ºä»€éº¼æœƒé€™æ¨£ï¼Ÿ

é€™å€‹å•é¡Œçš„é—œéµåœ¨æ–¼ **Next.js App Router çš„ç‰¹æ®Šæ–‡ä»¶ç³»çµ±æ©Ÿåˆ¶**ã€‚

## ğŸ“š æ·±å…¥ç†è§£ï¼šNext.js App Router ç‰¹æ®Šæ–‡ä»¶ç³»çµ±

### ç‰¹æ®Šæ–‡ä»¶çš„é­”æ³•èˆ‡é™·é˜±

Next.js App Router å¼•å…¥äº†ä¸€å¥—ç‰¹æ®Šçš„æ–‡ä»¶å‘½åç³»çµ±ï¼Œæ¯å€‹æ–‡ä»¶éƒ½æœ‰ç‰¹å®šçš„ä½œç”¨ï¼š

```
app/
â”œâ”€â”€ layout.tsx      # ğŸ—ï¸  ä½ˆå±€æ¨¡æ¿
â”œâ”€â”€ page.tsx        # ğŸ“„  é é¢å…§å®¹
â”œâ”€â”€ loading.tsx     # â³  è¼‰å…¥ç‹€æ…‹ â† é€™å°±æ˜¯å•é¡Œæ‰€åœ¨ï¼
â”œâ”€â”€ error.tsx       # ğŸš¨  éŒ¯èª¤è™•ç†
â”œâ”€â”€ not-found.tsx   # ğŸ”  404 é é¢
â””â”€â”€ template.tsx    # ğŸ“‹  æ¨¡æ¿çµ„ä»¶
```

### âš¡ loading.tsx çš„é‹ä½œæ©Ÿåˆ¶

`loading.tsx` ä¸¦ä¸æ˜¯æ™®é€šçš„çµ„ä»¶ï¼Œå®ƒæ˜¯ Next.js çš„ **Suspense é‚Šç•Œ**ï¼š

```tsx
// Next.js å…§éƒ¨å¯¦éš›ä¸Šæ˜¯é€™æ¨£é‹ä½œçš„
<Suspense fallback={<Loading />}>
  <YourPage />
</Suspense>
```

**è§¸ç™¼æ™‚æ©Ÿ**ï¼š

1. ğŸ”„ **è·¯ç”±åˆ‡æ›** - å°èˆªåˆ°æ–°é é¢æ™‚
2. ğŸ“¡ **æ•¸æ“šè¼‰å…¥** - Server Components å–å¾—æ•¸æ“šæ™‚
3. ğŸ¯ **å‹•æ…‹å°å…¥** - ä½¿ç”¨ `dynamic()` è¼‰å…¥çµ„ä»¶æ™‚

## ğŸ¤” å•é¡Œæ ¹æœ¬åŸå› åˆ†æ

### 1. ğŸŒ å…¨å±€ä½œç”¨åŸŸçš„å±éšªæ€§

```bash
app/loading.tsx  # âŒ å½±éŸ¿æ•´å€‹æ‡‰ç”¨çš„æ ¹ç´šè·¯ç”±
```

ç•¶ä½ åœ¨ `app/` æ ¹ç›®éŒ„æ”¾ç½® `loading.tsx` æ™‚ï¼Œå®ƒæœƒæˆç‚º**å…¨å±€ Suspense é‚Šç•Œ**ï¼Œå½±éŸ¿æ‰€æœ‰å­è·¯ç”±ã€‚

### 2. ğŸ”„ ç„¡é™å¾ªç’°çš„é™·é˜±

å•é¡Œçš„æ ¸å¿ƒåœ¨æ–¼**è¼‰å…¥ç‹€æ…‹æ°¸é ç„¡æ³•çµæŸ**ï¼š

```tsx
// å¯èƒ½çš„å•é¡Œå ´æ™¯
export default function Loading() {
  // å¦‚æœé€™å€‹çµ„ä»¶æœ¬èº«æœ‰éŒ¯èª¤æˆ–æ¸²æŸ“å•é¡Œ
  // æœƒå°è‡´ Suspense æ°¸é ç„¡æ³• resolve
  return <div>Loading...</div>;
}
```

### 3. ğŸš¨ éŒ¯èª¤è™•ç†çš„è¡çª

```
è¼‰å…¥ä¸­ â†’ ç™¼ç”ŸéŒ¯èª¤ â†’ é¡¯ç¤º Loading â†’ å†æ¬¡ç™¼ç”ŸéŒ¯èª¤ â†’ å¾ªç’°
```

Loading çµ„ä»¶å¯èƒ½æœƒé®è”½çœŸæ­£çš„éŒ¯èª¤ï¼Œé€ æˆé™¤éŒ¯å›°é›£ã€‚

## ğŸ› ï¸ è§£æ±ºæ–¹æ¡ˆï¼šä¸‰ç¨®æœ‰æ•ˆçš„ä¿®å¾©æ–¹æ³•

### ğŸš€ æ–¹æ¡ˆä¸€ï¼šç«‹å³ä¿®å¾© - ç§»é™¤å•é¡Œæ–‡ä»¶

**æœ€å¿«é€Ÿçš„è§£æ±ºæ–¹æ¡ˆ**ï¼šç›´æ¥ç§»é™¤æœ‰å•é¡Œçš„æ–‡ä»¶

```bash
# ç«‹å³è§£æ±ºå•é¡Œ
rm app/loading.tsx

# æ¸…é™¤ Next.js å¿«å–
rm -rf .next
npm run dev
```

**æ•ˆæœ**ï¼šç«‹å³æ¢å¾©æ‡‰ç”¨æ­£å¸¸é‹ä½œ

---

### ğŸ”§ æ–¹æ¡ˆäºŒï¼šå®‰å…¨å¯¦ç¾ - æ­£ç¢ºçš„å…¨å±€ loading

å¦‚æœä½ ç¢ºå¯¦éœ€è¦å…¨å±€è¼‰å…¥ç‹€æ…‹ï¼Œé€™æ˜¯æ­£ç¢ºçš„å¯¦ç¾æ–¹å¼ï¼š

```tsx
// âœ… å®‰å…¨çš„ loading.tsx å¯¦ç¾
export default function Loading() {
  return (
    <div className="flex items-center justify-center p-8">
      {/* ç°¡å–®çš„è¼‰å…¥å‹•ç•« - é¿å…è¤‡é›œçš„æ¨£å¼ */}
      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600" />
    </div>
  );
}
```

**é—œéµæ”¹é€²**ï¼š

- ğŸ¯ ç§»é™¤ `min-h-screen` - é¿å…ä½ˆå±€è¡çª
- âš¡ ç°¡åŒ–çµæ§‹ - æ¸›å°‘æ½›åœ¨éŒ¯èª¤
- ğŸ”’ ä¿å®ˆçš„æ¨£å¼ - é¿å…èˆ‡å…¶ä»– CSS è¡çª

---

### ğŸ¯ æ–¹æ¡ˆä¸‰ï¼šç²¾æº–æ§åˆ¶ - è·¯ç”±å±¤ç´šçš„ loading

**æœ€ä½³å¯¦è¸**ï¼šå°‡ loading æ”¾åœ¨ç‰¹å®šè·¯ç”±ç›®éŒ„ä¸­

```bash
# æ¨è–¦çš„ç›®éŒ„çµæ§‹
app/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ loading.tsx    # åªå½±éŸ¿ dashboard è·¯ç”±
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ analytics/
â”‚       â”œâ”€â”€ loading.tsx # åªå½±éŸ¿ dashboard/analytics
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ blog/
â”‚   â”œâ”€â”€ loading.tsx    # åªå½±éŸ¿ blog è·¯ç”±
â”‚   â””â”€â”€ page.tsx
â””â”€â”€ page.tsx           # é¦–é ä¸å—å½±éŸ¿
```

**ç‰¹å®šè·¯ç”±çš„ loading ç¯„ä¾‹**ï¼š

```tsx
// app/dashboard/loading.tsx
export default function DashboardLoading() {
  return (
    <div className="space-y-4 p-6">
      <div className="h-8 bg-gray-200 rounded w-1/4 animate-pulse" />
      <div className="grid grid-cols-3 gap-4">
        {[...Array(6)].map((_, i) => (
          <div key={i} className="h-24 bg-gray-200 rounded animate-pulse" />
        ))}
      </div>
    </div>
  );
}
```

---

import SolutionComparisonTable from "./components/SolutionComparisonTable";

<SolutionComparisonTable />

## ğŸ¯ é–‹ç™¼æœ€ä½³å¯¦è¸æŒ‡å—

### 1. ğŸš« é¿å…å…¨å±€ loading.tsx é™·é˜±

```tsx
// âŒ å±éšªï¼šå…¨å±€ loading
app / loading.tsx;

// âœ… å®‰å…¨ï¼šè·¯ç”±ç‰¹å®š loading
app / dashboard / loading.tsx;
app / profile / loading.tsx;
```

**åŸå‰‡**ï¼šé™¤éä½ å®Œå…¨äº†è§£å…¶å½±éŸ¿ï¼Œå¦å‰‡é¿å…åœ¨ `app/` æ ¹ç›®éŒ„å‰µå»º `loading.tsx`ã€‚

---

### 2. ğŸ¨ çµ„ä»¶ç´šåˆ¥çš„è¼‰å…¥ç‹€æ…‹

**ä½¿ç”¨ React Suspense**ï¼š

```tsx
import { Suspense } from "react";

function ProductPage() {
  return (
    <div className="container mx-auto p-6">
      <h1>ç”¢å“é é¢</h1>

      {/* é‡å°ç‰¹å®šçµ„ä»¶çš„è¼‰å…¥ç‹€æ…‹ */}
      <Suspense fallback={<ProductListSkeleton />}>
        <ProductList />
      </Suspense>

      <Suspense fallback={<ReviewsSkeleton />}>
        <Reviews />
      </Suspense>
    </div>
  );
}

// éª¨æ¶å±çµ„ä»¶
function ProductListSkeleton() {
  return (
    <div className="grid grid-cols-3 gap-4">
      {[...Array(6)].map((_, i) => (
        <div key={i} className="animate-pulse">
          <div className="bg-gray-200 h-48 rounded-lg mb-2" />
          <div className="bg-gray-200 h-4 rounded w-3/4 mb-1" />
          <div className="bg-gray-200 h-4 rounded w-1/2" />
        </div>
      ))}
    </div>
  );
}
```

---

### 3. ğŸ”„ æ¢ä»¶æ¸²æŸ“çš„è¼‰å…¥è™•ç†

**åœ¨çµ„ä»¶å…§éƒ¨ç®¡ç†ç‹€æ…‹**ï¼š

```tsx
"use client";

import { useState, useEffect } from "react";

function UserProfile({ userId }: { userId: string }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function fetchUser() {
      try {
        const response = await fetch(`/api/users/${userId}`);
        const userData = await response.json();
        setUser(userData);
      } catch (err) {
        setError("è¼‰å…¥ç”¨æˆ¶è³‡æ–™å¤±æ•—");
      } finally {
        setLoading(false);
      }
    }

    fetchUser();
  }, [userId]);

  // è¼‰å…¥ç‹€æ…‹
  if (loading) {
    return (
      <div className="flex items-center space-x-2">
        <div className="animate-spin h-4 w-4 border-2 border-blue-600 rounded-full border-t-transparent" />
        <span>è¼‰å…¥ç”¨æˆ¶è³‡æ–™ä¸­...</span>
      </div>
    );
  }

  // éŒ¯èª¤ç‹€æ…‹
  if (error) {
    return <div className="text-red-600">{error}</div>;
  }

  // æ­£å¸¸å…§å®¹
  return <div>ç”¨æˆ¶ï¼š{user.name}</div>;
}
```

---

### 4. ğŸ§ª è¼‰å…¥ç‹€æ…‹çš„æ¸¬è©¦ç­–ç•¥

**ç¢ºä¿ loading çµ„ä»¶åœ¨å„ç¨®æƒ…æ³ä¸‹éƒ½æ­£å¸¸å·¥ä½œ**ï¼š

```tsx
// æ¸¬è©¦å‹å¥½çš„ loading çµ„ä»¶
export default function Loading() {
  return (
    <div
      className="p-4"
      data-testid="loading-indicator"
      role="status"
      aria-label="è¼‰å…¥ä¸­"
    >
      <div className="animate-pulse space-y-4">
        <div className="h-4 bg-gray-200 rounded w-3/4" />
        <div className="h-4 bg-gray-200 rounded w-1/2" />
        <div className="h-20 bg-gray-200 rounded" />
      </div>
    </div>
  );
}
```

**æ¸¬è©¦ç¯„ä¾‹**ï¼š

```tsx
// __tests__/loading.test.tsx
import { render, screen } from "@testing-library/react";
import Loading from "../app/dashboard/loading";

test("è¼‰å…¥çµ„ä»¶æ­£å¸¸æ¸²æŸ“", () => {
  render(<Loading />);
  expect(screen.getByRole("status")).toBeInTheDocument();
  expect(screen.getByLabelText("è¼‰å…¥ä¸­")).toBeInTheDocument();
});
```

## ğŸ” ç³»çµ±åŒ–é™¤éŒ¯æµç¨‹

ç•¶é‡åˆ°é¡ä¼¼çš„è¼‰å…¥å•é¡Œæ™‚ï¼Œè«‹æŒ‰ç…§ä»¥ä¸‹**ç§‘å­¸åŒ–é™¤éŒ¯æ­¥é©Ÿ**ï¼š

### ğŸ¯ Step 1ï¼šå¿«é€Ÿå®šä½å•é¡Œ

```bash
# æª¢æŸ¥æ˜¯å¦å­˜åœ¨å•é¡Œæ–‡ä»¶
ls -la app/loading.tsx app/error.tsx app/not-found.tsx

# æŸ¥çœ‹æœ€è¿‘çš„ git è®Šæ›´
git log --oneline -10
git status
```

### ğŸ”¬ Step 2ï¼šéš”é›¢æ¸¬è©¦

**æš«æ™‚ç§»é™¤å¯ç–‘æ–‡ä»¶**ï¼š

```bash
# å‚™ä»½ä¸¦ç§»é™¤
mv app/loading.tsx app/loading.tsx.backup
mv app/error.tsx app/error.tsx.backup

# æ¸…é™¤å¿«å–ä¸¦é‡å•Ÿ
rm -rf .next
npm run dev
```

**çµæœåˆ¤æ–·**ï¼š

- âœ… å¦‚æœå•é¡Œè§£æ±º â†’ ç¢ºèªæ˜¯ç‰¹æ®Šæ–‡ä»¶å•é¡Œ
- âŒ å¦‚æœå•é¡Œä¾èˆŠ â†’ ç¹¼çºŒä¸‹ä¸€æ­¥

### ğŸ“Š Step 3ï¼šè©³ç´°æ—¥èªŒåˆ†æ

**æª¢æŸ¥å¤šå€‹æ—¥èªŒä¾†æº**ï¼š

```bash
# ç€è¦½å™¨æ§åˆ¶å°éŒ¯èª¤
# æŒ‰ F12 â†’ Console â†’ æŸ¥çœ‹ç´…è‰²éŒ¯èª¤è¨Šæ¯

# Next.js é–‹ç™¼æœå‹™å™¨æ—¥èªŒ
npm run dev
# è§€å¯Ÿçµ‚ç«¯è¼¸å‡º

# æª¢æŸ¥ç¶²è·¯è«‹æ±‚
# F12 â†’ Network â†’ æŸ¥çœ‹å¤±æ•—çš„è«‹æ±‚
```

### ğŸ§ª Step 4ï¼šé€æ­¥æ¢å¾©æ¸¬è©¦

```bash
# é€ä¸€æ¢å¾©æ–‡ä»¶ä¸¦æ¸¬è©¦
mv app/loading.tsx.backup app/loading.tsx
npm run dev
# æ¸¬è©¦æ˜¯å¦æ­£å¸¸

# å¦‚æœå•é¡Œé‡ç¾ï¼Œæª¢æŸ¥æ–‡ä»¶å…§å®¹
cat app/loading.tsx
```

### âš¡ Step 5ï¼šç·Šæ€¥ä¿®å¾©æ¸…å–®

å¦‚æœéœ€è¦å¿«é€Ÿæ¢å¾©ç·šä¸Šæœå‹™ï¼š

```bash
# 1. ç§»é™¤æ‰€æœ‰å¯ç–‘çš„ç‰¹æ®Šæ–‡ä»¶
rm -f app/loading.tsx app/error.tsx app/template.tsx

# 2. æ¸…é™¤æ‰€æœ‰å¿«å–
rm -rf .next node_modules/.cache

# 3. é‡æ–°å®‰è£ä¾è³´
npm install

# 4. é‡æ–°å»ºç½®
npm run build
npm start
```

## ğŸ“ é—œéµè¦é»ç¸½çµ

é€™å€‹çœ‹ä¼¼ç°¡å–®çš„ `loading.tsx` é™·é˜±ï¼Œå¯¦éš›ä¸Šåæ˜ äº† **Next.js App Router å¼·å¤§åŠŸèƒ½èƒŒå¾Œçš„è¤‡é›œæ€§**ã€‚

import KeyLessonsTable from "./components/KeyLessonsTable";

<KeyLessonsTable />

### ğŸš€ ç«‹å³è¡Œå‹•æ¸…å–®

**æª¢æŸ¥ä½ çš„å°ˆæ¡ˆ**ï¼š

```bash
# 1. æª¢æŸ¥æ˜¯å¦æœ‰å±éšªçš„å…¨å±€ loading
find app -name "loading.tsx" -type f

# 2. å¦‚æœå­˜åœ¨ app/loading.tsxï¼Œè©•ä¼°æ˜¯å¦çœŸçš„éœ€è¦
ls -la app/loading.tsx

# 3. è€ƒæ…®ç§»å‹•åˆ°ç‰¹å®šè·¯ç”±ç›®éŒ„
mkdir -p app/dashboard
mv app/loading.tsx app/dashboard/loading.tsx
```

### ğŸ“ å»¶ä¼¸å­¸ç¿’

æƒ³è¦å®Œå…¨æŒæ¡ Next.js App Router çš„è¼‰å…¥æ©Ÿåˆ¶å—ï¼Ÿ

- ğŸ“– [Next.js Loading UI å®˜æ–¹æ–‡æª”](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)
- ğŸ§ª [React Suspense æ·±å…¥ç†è§£](https://react.dev/reference/react/Suspense)
- ğŸ”§ [Next.js é™¤éŒ¯æœ€ä½³å¯¦è¸](https://nextjs.org/docs/app/building-your-application/configuring)

---

### ğŸ’¡ æœ€å¾Œçš„æ€è€ƒ

**æ¯ä¸€å€‹çœ‹ä¼¼ç°¡å–®çš„åŠŸèƒ½ï¼Œéƒ½å¯èƒ½éš±è—è‘—è¤‡é›œçš„æ©Ÿåˆ¶ã€‚**

åœ¨ä½¿ç”¨ Next.js App Router çš„ç‰¹æ®Šæ–‡ä»¶æ™‚ï¼Œè«‹è¨˜ä½ï¼š

- ğŸ§  **ç†è§£å…¶å·¥ä½œåŸç†**ï¼Œè€Œä¸åªæ˜¯æœƒç”¨
- ğŸ”¬ **æ¸¬è©¦å„ç¨®å ´æ™¯**ï¼Œç¢ºä¿ç©©å®šæ€§
- ğŸ“š **æŒçºŒå­¸ç¿’**ï¼Œè·Ÿä¸Šæ¡†æ¶æ›´æ–°

å¸Œæœ›é€™ç¯‡æ–‡ç« èƒ½å¹«åŠ©ä½ é¿å…åŒæ¨£çš„é™·é˜±ï¼Œè®“ Next.js é–‹ç™¼æ›´åŠ é †æš¢ï¼

---

_ğŸ’» é€™å€‹å•é¡Œåœ¨é–‹ç™¼éç¨‹ä¸­çœŸå¯¦é‡åˆ°ï¼Œç¶“éæ·±å…¥åˆ†æå’Œæ¸¬è©¦ç¸½çµè€Œæˆã€‚å¦‚æœä½ ä¹Ÿé‡åˆ°é¡ä¼¼å•é¡Œï¼Œæ­¡è¿åˆ†äº«ä½ çš„è§£æ±ºç¶“é©—ï¼_
